<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>HBase简介（很好的梳理资料） | 农永滔的博客</title>
  
  <meta name="keywords" content="hadoop,Spring,大数据,Java,nongyongtao,mybatis">
  
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="https://raw.githubusercontent.com/tokerr/markdownImage/master/images/favicon.png">
  <link rel="alternate" href="/atom.xml" title="农永滔的博客">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="shortcut icon" href="undefined" />
  <link rel="icon" href="https://raw.githubusercontent.com/tokerr/markdownImage/master/images/favicon.png" />
  
  <link href="https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono" rel="stylesheet">
  
  <!-- <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>

  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
  
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?7c0d3796d074be0957be656beaf84aca";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
</head>

<body>
    <div id="loading-bar-wrapper">
  <div id="loading-bar" class="pure"></div>
</div>

    <script>setLoadingBarProgress(20)</script>
    <header class="l_header pure">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >农永滔的博客</a>
				<div class='menu'>
					<ul class='h-list'>
            
    					
    						<li>
									<a id="not_current"
									 class="nav flat-box" href="/">
										<i class='fas fa-home fa-fw'></i>&nbsp;主页
									</a>
  							</li>
        			
    						<li>
									<a id="not_current"
									 class="nav flat-box" href="/archives/">
										<i class='fas fa-archive fa-fw'></i>&nbsp;归档
									</a>
  							</li>
        			
        		
					</ul>
					<div class='underline'></div>
				</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon"><i class="fas fa-search fa-fw"></i></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></span></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
				<li class='s-top'><a class="fas fa-arrow-up fa-fw" href='javascript:void(0)'></a></li>
				<li class='s-toc'><a class="fas fa-list fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
		<nav>
      <ul>
          
              
                  <li>
										<a class="nav  flat-box" href="/">
											<i class='fas fa-home fa-fw'></i>&nbsp;主页
										</a>
                  </li>
              
                  <li>
										<a class="nav  flat-box" href="/archives/">
											<i class='fas fa-archive fa-fw'></i>&nbsp;归档
										</a>
                  </li>
              
       
      </ul>
		</nav>
	</aside>

    <script>setLoadingBarProgress(40);</script>
    <div class="l_body">
    <div class='container clearfix'>
        <div class='l_main'>
            <article id="post-HBase简介（很好的梳理资料）" class="post white-box article-type-post" itemscope itemprop="blogPost">
    <section class='meta'>
      
      <div class="meta" id="header-meta">
        
            <h1 class="title">HBase简介（很好的梳理资料）</h1>
        
        <time class="time">
            <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
            2017-10-29
        </time>
        
          <div class="browse busuanzi"><i class="fas fa-eye fa-fw" aria-hidden="true"></i>
            <span id="busuanzi_value_page_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
          </div>
        

        

      </div>
    </section>

    <section class="article typo">

        <div class="article-entry" itemprop="articleBody">
            <p>这篇博客梳理的太好了，附上大牛博主的<a href="http://jiajun.iteye.com/" target="_blank" rel="external">博客地址</a>。</p>
<h1 id="一、-简介"><a href="#一、-简介" class="headerlink" title="一、 简介"></a>一、 简介</h1><p><strong>history</strong></p>
<ul>
<li>started by chad walters and jim</li>
<li>2006.11 G release paper on BigTable</li>
<li>2007.2 inital HBase prototype created as Hadoop contrib</li>
<li>2007.10 First useable Hbase</li>
<li>2008.1 Hadoop become Apache top-level project and Hbase becomes subproject</li>
<li>2008.10 Hbase 0.18,0.19 released</li>
</ul>
<p>hbase是bigtable的开源山寨版本。是建立的hdfs之上，提供高可靠性、高性能、列存储、可伸缩、实时读写的数据库系统。<br><a id="more"></a><br>它介于nosql和RDBMS之间，仅能通过主键(row key)和主键的range来检索数据，仅支持单行事务(可通过hive支持来实现多表join等复杂操作)。主要用来存储非结构化和半结构化的松散数据。</p>
<p>与hadoop一样，Hbase目标主要依靠横向扩展，通过不断增加廉价的商用服务器，来增加计算和存储能力。</p>
<p><br><br>HBase中的表一般有这样的特点：</p>
<ol>
<li>大：一个表可以有上亿行，上百万列</li>
<li>面向列:面向列(族)的存储和权限控制，列(族)独立检索。</li>
<li>稀疏:对于为空(null)的列，并不占用存储空间，因此，表可以设计的非常稀疏。</li>
</ol>
<p>下面一幅图是Hbase在Hadoop Ecosystem中的位置。<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image.png" alt=""></p>
<h1 id="二、-逻辑视图"><a href="#二、-逻辑视图" class="headerlink" title="二、 逻辑视图"></a>二、 逻辑视图</h1><p>HBase以表的形式存储数据。表有行和列组成。列划分为若干个列族(row family)<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_11_.png" alt=""></p>
<h3 id="Row-Key"><a href="#Row-Key" class="headerlink" title="Row Key"></a>Row Key</h3><p>与nosql数据库们一样,row key是用来检索记录的主键。访问hbase table中的行，只有三种方式：</p>
<ol>
<li>通过单个row key访问</li>
<li>通过row key的range</li>
<li>全表扫描</li>
</ol>
<p>Row key行键 (Row key)可以是任意字符串(最大长度是 64KB，实际应用中长度一般为 10-100bytes)，在hbase内部，row key保存为字节数组。</p>
<p>存储时，数据按照Row key的字典序(byte order)排序存储。设计key时，要充分排序存储这个特性，将经常一起读取的行存储放到一起。(位置相关性)<br>注意：<br>字典序对int排序的结果是1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,<br>…,9,91,92,93,94,95,96,97,98,99。要保持整形的自然序，行键必须用0作左填充。</p>
<p>行的一次读写是原子操作 (不论一次读写多少列)。这个设计决策能够使用户很容易的理解程序在对同一个行进行并发更新操作时的行为。</p>
<h3 id="列族"><a href="#列族" class="headerlink" title="列族"></a>列族</h3><p>hbase表中的每个列，都归属与某个列族。列族是表的chema的一部分(而列不是)，必须在使用表之前定义。列名都以列族作为前缀。例如courses:history ， courses:math 都属于 courses 这个列族。<br>访问控制、磁盘和内存的使用统计都是在列族层面进行的。实际应用中，列族上的控制权限能 帮助我们管理不同类型的应用：我们允许一些应用可以添加新的基本数据、一些应用可以读取基本数据并创建继承的列族、一些应用则只允许浏览数据（甚至可能因 为隐私的原因不能浏览所有数据）。</p>
<h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>HBase中通过row和columns确定的为一个存贮单元称为cell。每个 cell都保存着同一份数据的多个版本。版本通过时间戳来索引。时间戳的类型是 64位整型。时间戳可以由hbase(在数据写入时自动 )赋值，此时时间戳是精确到毫秒的当前系统时间。时间戳也可以由客户显式赋值。如果应用程序要避免数据版本冲突，就必须自己生成具有唯一性的时间戳。每个 cell中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。<br>为了避免数据存在过多版本造成的的管理 (包括存贮和索引)负担，hbase提供了两种数据版本回收方式。一是保存数据的最后n个版本，二是保存最近一段时间内的版本（比如最近七天）。用户可以针对每个列族进行设置。</p>
<h3 id="Cell"><a href="#Cell" class="headerlink" title="Cell"></a>Cell</h3><p>由{row key, column( =<family> + <label>), version} 唯一确定的单元。cell中的数据是没有类型的，全部是字节码形式存贮。</label></family></p>
<h1 id="三、-物理存储"><a href="#三、-物理存储" class="headerlink" title="三、 物理存储"></a>三、 物理存储</h1><p>1.已经提到过，Table中的所有行都按照row key的字典序排列。</p>
<p>2.Table 在行的方向上分割为多个Hregion。</p>
<p><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_1_.png" alt=""></p>
<p>3.region按大小分割的，每个表一开始只有一个region，随着数据不断插入表，region不断增大，当增大到一个阀值的时候，Hregion就会等分会两个新的Hregion。当table中的行不断增多，就会有越来越多的Hregion。<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_2_.png" alt=""></p>
<p>4.Hregion是Hbase中分布式存储和负载均衡的最小单元。最小单元就表示不同的Hregion可以分布在不同的HRegion server上。但一个Hregion是不会拆分到多个server上的。<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_3_.png" alt=""></p>
<p>5.<strong>HRegion虽然是分布式存储的最小单元，但并不是存储的最小单元。</strong></p>
<p>事实上，HRegion由一个或者多个Store组成，每个store保存一个columns family。</p>
<p>每个Strore又由一个memStore和0至多个StoreFile组成。如图：</p>
<p>StoreFile以HFile格式保存在HDFS上。<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_4_.png" alt=""></p>
<p>HFile的格式为：<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_5_.png" alt=""></p>
<p>Trailer部分的格式:<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_6_.png" alt=""></p>
<p><em>HFile分为六个部分：</em></p>
<ol>
<li>Data Block 段–保存表中的数据，这部分可以被压缩</li>
<li>Meta Block 段 (可选的)–保存用户自定义的kv对，可以被压缩。</li>
<li>File Info 段–Hfile的元信息，不被压缩，用户也可以在这一部分添加自己的元信息。</li>
<li>Data Block Index 段–Data Block的索引。每条索引的key是被索引的block的第一条记录的key。</li>
<li>Meta Block Index段 (可选的)–Meta Block的索引。</li>
<li>Trailer–这一段是定长的。保存了每一段的偏移量，读取一个HFile时，会首先 读取Trailer，Trailer保存了每个段的起始位置(段的Magic Number用来做安全check)，然后，DataBlock Index会被读取到内存中，这样，当检索某个key时，不需要扫描整个HFile，而只需从内存中找到key所在的block，通过一次磁盘io将整个 block读取到内存中，再找到需要的key。DataBlock Index采用LRU机制淘汰。</li>
</ol>
<p>HFile的Data Block，Meta Block通常采用压缩方式存储，压缩之后可以大大减少网络IO和磁盘IO，随之而来的开销当然是需要花费cpu进行压缩和解压缩。<br>目标Hfile的压缩支持两种方式：Gzip，Lzo。</p>
<p><em>HLog(WAL log)</em></p>
<p>WAL 意为Write ahead log(<a href="http://en.wikipedia.org/wiki/Write-ahead_logging)，类似mysql中的binlog,用来" target="_blank" rel="external">http://en.wikipedia.org/wiki/Write-ahead_logging)，类似mysql中的binlog,用来</a> 做灾难恢复只用，Hlog记录数据的所有变更,一旦数据修改，就可以从log中进行恢复。</p>
<p>每个Region Server维护一个Hlog,而不是每个Region一个。这样不同region(来自不同table)的日志会混在一起，这样做的目的是不断追加单个 文件相对于同时写多个文件而言，可以减少磁盘寻址次数，因此可以提高对table的写性能。带来的麻烦是，如果一台region server下线，为了恢复其上的region，需要将region server上的log进行拆分，然后分发到其它region server上进行恢复。</p>
<p>HLog文件就是一个普通的Hadoop Sequence File，Sequence File 的Key是HLogKey对象，HLogKey中记录了写入数据的归属信息，除了table和region名字外，同时还包括 sequence number和timestamp，timestamp是”写入时间”，sequence number的起始值为0，或者是最近一次存入文件系统中sequence number。HLog Sequece File的Value是HBase的KeyValue对象，即对应HFile中的KeyValue，可参见上文描述。</p>
<h1 id="四、-系统架构"><a href="#四、-系统架构" class="headerlink" title="四、 系统架构"></a>四、 系统架构</h1><p><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_7_.png" alt=""><br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_8_.png" alt=""></p>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><ol>
<li>包含访问hbase的接口，client维护着一些cache来加快对hbase的访问，比如regione的位置信息。</li>
</ol>
<h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><ol>
<li>保证任何时候，集群中只有一个master</li>
<li>存贮所有Region的寻址入口。</li>
<li>实时监控Region Server的状态，将Region server的上线和下线信息实时通知给Master</li>
<li>存储Hbase的schema,包括有哪些table，每个table有哪些column family</li>
</ol>
<h3 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h3><ol>
<li>为Region server分配region</li>
<li>负责region server的负载均衡</li>
<li>发现失效的region server并重新分配其上的region</li>
<li>GFS上的垃圾文件回收</li>
<li>处理schema更新请求</li>
</ol>
<h3 id="Region-Server"><a href="#Region-Server" class="headerlink" title="Region Server"></a>Region Server</h3><ol>
<li>Region server维护Master分配给它的region，处理对这些region的IO请求</li>
<li>Region server负责切分在运行过程中变得过大的region</li>
</ol>
<p>可以看到，client访问hbase上数据的过程并不需要master参与（寻址访问zookeeper和region server，数据读写访问regione server），master仅仅维护者table和region的元数据信息，负载很低。</p>
<h1 id="五、关键算法-流程"><a href="#五、关键算法-流程" class="headerlink" title="五、关键算法 / 流程"></a>五、关键算法 / 流程</h1><h3 id="region定位"><a href="#region定位" class="headerlink" title="region定位"></a>region定位</h3><p>系统如何找到某个row key (或者某个 row key range)所在的region</p>
<p>bigtable 使用三层类似B+树的结构来保存region位置。</p>
<p>第一层是保存zookeeper里面的文件，它持有root region的位置。</p>
<p>第二层root region是.META.表的第一个region其中保存了.META.z表其它region的位置。通过root region，我们就可以访问.META.表的数据。</p>
<p>.META.是第三层，它是一个特殊的表，保存了hbase中所有数据表的region 位置信息。<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_9_.png" alt=""></p>
<p><strong>说明：</strong></p>
<p>1.root region永远不会被split，保证了最需要三次跳转，就能定位到任意region 。</p>
<p>2.META.表每行保存一个region的位置信息，row key 采用表名+表的最后一样编码而成。</p>
<p>3.为了加快访问，.META.表的全部region都保存在内存中。</p>
<p>假设，.META.表的一行在内存中大约占用1KB。并且每个region限制为128MB。</p>
<p>那么上面的三层结构可以保存的region数目为：</p>
<p>(128MB/1KB) * (128MB/1KB) = = 2(34)个region</p>
<p>4.client会将查询过的位置信息保存缓存起来，缓存不会主动失效，因此如果client上的缓存全部失效，则需要进行6次网络来回，才能定位到正确的region(其中三次用来发现缓存失效，另外三次用来获取位置信息)。</p>
<h3 id="读写过程"><a href="#读写过程" class="headerlink" title="读写过程"></a>读写过程</h3><p>上文提到，hbase使用MemStore和StoreFile存储对表的更新。</p>
<p>数据在更新时首先写入Log(WAL log)和内存(MemStore)中，MemStore中的数据是排序的，当MemStore累计到一定阈值时，就会创建一个新的MemStore，并 且将老的MemStore添加到flush队列，由单独的线程flush到磁盘上，成为一个StoreFile。于此同时，系统会在zookeeper中 记录一个redo point，表示这个时刻之前的变更已经持久化了。(minor compact)</p>
<p>当系统出现意外时，可能导致内存(MemStore)中的数据丢失，此时使用Log(WAL log)来恢复checkpoint之后的数据。</p>
<p>前面提到过StoreFile是只读的，一旦创建后就不可以再修改。因此Hbase的更 新其实是不断追加的操作。当一个Store中的StoreFile达到一定的阈值后，就会进行一次合并(major compact),将对同一个key的修改合并到一起，形成一个大的StoreFile，当StoreFile的大小达到一定阈值后，又会对 StoreFile进行split，等分为两个StoreFile。</p>
<p>由于对表的更新是不断追加的，处理读请求时，需要访问Store中全部的 StoreFile和MemStore，将他们的按照row key进行合并，由于StoreFile和MemStore都是经过排序的，并且StoreFile带有内存中索引，合并的过程还是比较快。</p>
<p>写请求处理过程<br><img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/HBase%E7%AE%80%E4%BB%8B%EF%BC%88%E5%BE%88%E5%A5%BD%E7%9A%84%E6%A2%B3%E7%90%86%E8%B5%84%E6%96%99%EF%BC%89/Image_10_.png" alt=""></p>
<ol>
<li>client向region server提交写请求</li>
<li>region server找到目标region</li>
<li>region检查数据是否与schema一致</li>
<li>如果客户端没有指定版本，则获取当前系统时间作为数据版本</li>
<li>将更新写入WAL log</li>
<li>将更新写入Memstore</li>
<li>判断Memstore的是否需要flush为Store文件。</li>
</ol>
<h3 id="region分配"><a href="#region分配" class="headerlink" title="region分配"></a>region分配</h3><p>任何时刻，一个region只能分配给一个region server。master记录了当前有哪些可用的region server。以及当前哪些region分配给了哪些region server，哪些region还没有分配。当存在未分配的region，并且有一个region server上有可用空间时，master就给这个region server发送一个装载请求，把region分配给这个region server。region server得到请求后，就开始对此region提供服务。</p>
<h3 id="region-server上线"><a href="#region-server上线" class="headerlink" title="region server上线"></a>region server上线</h3><p>master使用zookeeper来跟踪region server状态。当某个region server启动时，会首先在zookeeper上的server目录下建立代表自己的文件，并获得该文件的独占锁。由于master订阅了server 目录上的变更消息，当server目录下的文件出现新增或删除操作时，master可以得到来自zookeeper的实时通知。因此一旦region server上线，master能马上得到消息。</p>
<h3 id="region-server下线"><a href="#region-server下线" class="headerlink" title="region server下线"></a>region server下线</h3><p>当region server下线时，它和zookeeper的会话断开，zookeeper而自动释放代表这台server的文件上的独占锁。而master不断轮询 server目录下文件的锁状态。如果master发现某个region server丢失了它自己的独占锁，(或者master连续几次和region server通信都无法成功),master就是尝试去获取代表这个region server的读写锁，一旦获取成功，就可以确定：</p>
<ol>
<li>region server和zookeeper之间的网络断开了。</li>
<li>region server挂了。</li>
</ol>
<p>的其中一种情况发生了，无论哪种情况，region server都无法继续为它的region提供服务了，此时master会删除server目录下代表这台region server的文件，并将这台region server的region分配给其它还活着的同志。</p>
<p>如果网络短暂出现问题导致region server丢失了它的锁，那么region server重新连接到zookeeper之后，只要代表它的文件还在，它就会不断尝试获取这个文件上的锁，一旦获取到了，就可以继续提供服务。</p>
<h3 id="master上线"><a href="#master上线" class="headerlink" title="master上线"></a>master上线</h3><p>master启动进行以下步骤:</p>
<ol>
<li>从zookeeper上获取唯一一个代码master的锁，用来阻止其它master成为master。</li>
<li>扫描zookeeper上的server目录，获得当前可用的region server列表。</li>
<li>和2中的每个region server通信，获得当前已分配的region和region server的对应关系。</li>
<li>扫描.META.region的集合，计算得到当前还未分配的region，将他们放入待分配region列表。</li>
</ol>
<h3 id="master下线"><a href="#master下线" class="headerlink" title="master下线"></a>master下线</h3><p>由于master只维护表和region的元数据，而不参与表数据IO的过 程，master下线仅导致所有元数据的修改被冻结(无法创建删除表，无法修改表的schema，无法进行region的负载均衡，无法处理region 上下线，无法进行region的合并，唯一例外的是region的split可以正常进行，因为只有region server参与)，表的数据读写还可以正常进行。因此master下线短时间内对整个hbase集群没有影响。从上线过程可以看到，master保存的 信息全是可以冗余信息（都可以从系统其它地方收集到或者计算出来），因此，一般hbase集群中总是有一个master在提供服务，还有一个以上 的’master’在等待时机抢占它的位置。</p>
<h1 id="六、访问接口"><a href="#六、访问接口" class="headerlink" title="六、访问接口"></a>六、访问接口</h1><pre><code>HBase Shell
Java clietn API
HBase non-java access
languages talking to the JVM
Jython interface to HBase
Groovy DSL for HBase
Scala interface to HBase
languages with a custom protocol
REST gateway specification for HBase
充分利用HTTP协议：GET POST PUT DELETE
§
text/plain
text/xml
application/json
application/x-protobuf
Thrift gateway specification for HBase
java
cpp
rb
py
perl
php
HBase Map Reduce
Hive/Pig
</code></pre><h1 id="七、结语："><a href="#七、结语：" class="headerlink" title="七、结语："></a>七、结语：</h1><p>全文对 Hbase做了 简单的介绍，有错误之处，敬请指正。未来将结合 Hbase 在淘宝数据平台的应用场景，在更多细节上进行深入。</p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p>Bigtable: A Distributed Storage System for Structured Data</p>
<p>HFile: A Block-Indexed File Format to Store Sorted Key-Value Pairs for a thorough</p>
<p>introduction Hbase Architecture 101</p>
<p>Hbase source code</p>

        </div>

        <section class='meta' id="footer-meta">
            <time class="time" itemprop="dateUpdated" datetime="2019-05-01T21:51:07+08:00" content="2019-05-01">
                <i class="fas fa-pen fa-fw" aria-hidden="true"></i>
                本文最后更新于：2019-05-01
            </time>
            
                
                <div class="tags">
                    <i class="fas fa-tags fa-fw" aria-hidden="true"></i>
                    <a class="tag" href="/tags/hadoop/">hadoop</a>, <a class="tag" href="/tags/zookeeper/">zookeeper</a>, <a class="tag" href="/tags/hbase/">hbase</a>
                </div>
            
        </section>

        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一篇</h6>
                            <h4>
                                <a href="/2017/10/25/sqoop学习笔记/" rel="prev" title="sqoop学习笔记">
                                  
                                      sqoop学习笔记
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <i class="fas fa-tags fa-fw" aria-hidden="true"></i>
                                    <a class="tag" href="/tags/hadoop/">hadoop</a>, <a class="tag" href="/tags/sqoop/">sqoop</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一篇&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2017/11/20/负载均衡session共享解决方法整理/" rel="prev" title="负载均衡session共享解决方法整理">
                                    
                                        负载均衡session共享解决方法整理
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <i class="fas fa-tags fa-fw" aria-hidden="true"></i>
                                    <a class="tag" href="/tags/java/">java</a>, <a class="tag" href="/tags/session/">session</a>, <a class="tag" href="/tags/cookie/">cookie</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        

    </section>

</article>

<br>

<!-- 显示推荐文章和评论 -->

    <article class="post white-box comments">
        <section class="article typo">

            
                

    <div class="recommended_posts">
        <h4><i class="fas fa-bookmark fa-fw" aria-hidden="true"></i>&nbsp;你可能感兴趣的文章</h4>
        <ul>
            
                <li><a href="https://tokerr.github.io/2017/10/24/hadoop-zookeeper集群搭建/">hadoop+zookeeper集群搭建</a></li>
            
                <li><a href="https://tokerr.github.io/2017/10/25/sqoop学习笔记/">sqoop学习笔记</a></li>
            
                <li><a href="https://tokerr.github.io/2017/11/20/负载均衡session共享解决方法整理/">负载均衡session共享解决方法整理</a></li>
            
                <li><a href="https://tokerr.github.io/2017/12/17/虚拟机host-only下配置与宿主机共享网络/">虚拟机host-only下配置与宿主机共享网络</a></li>
            
        </ul>
    </div>


            

            

                <h4>
                    <div style="cursor:pointer;width: 75px;" onclick="$('html, body').animate({scrollTop: $('#gitalk-container').offset().top  }, 500);">
                        <i class="fas fa-comments fa-fw" aria-hidden="true" ></i>&nbsp;评论
                    </div>
                </h4>
                

                

                
            

        </section>
    </article>


<script>
    window.subData = {
        title: 'HBase简介（很好的梳理资料）',
        tools: true
    }
</script>


        </div>
        <aside class='l_side'>
            
    
        
  <section class='m_widget author'>
    
      <div class='header'>
        <img class='avatar' src='https://raw.githubusercontent.com/tokerr/markdownImage/master/images/head.jpeg'/>
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="mailto:nytom@foxmail.com" class="social flat-box" target="_blank" rel="external"><i class="social fas fa-envelope" aria-hidden="true"></i></a>
          
        
          
            <a href="https://github.com/tokerr" class="social flat-box" target="_blank" rel="external"><i class="social fab fa-github" aria-hidden="true"></i></a>
          
        
          
            <a href="https://y.qq.com/n/yqq/playlist/2801715580.html" class="social flat-box" target="_blank" rel="external"><i class="social fas fa-music" aria-hidden="true"></i></a>
          
        
      </div>
    
  </section>


    
    
        
  <section class='m_widget announcement'>
    <header class='header pure'>
        <div><i class="fas fa-bullhorn fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;公告</div>
    </header>
    <div class='content pure'>
      这是我的<b><a href="https://github.com/tokerr">GitHub</a></b>。
    </div>
  </section>


    
    
        <section class='m_widget categories'>
    <header class='header pure'>
        <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;分类</div>
    </header>
    <div class='content pure'>
        
    </div>
</section>

    
    
        
    <section class='m_widget tagcloud'>
        <header class="header pure">
            <div><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;标签</div>
        </header>
        <div class='content pure'>
            <a href="/tags/Collection/" style="font-size: 14px; color: #999">Collection</a> <a href="/tags/HDFS/" style="font-size: 14px; color: #999">HDFS</a> <a href="/tags/List/" style="font-size: 14px; color: #999">List</a> <a href="/tags/MapReducer/" style="font-size: 14px; color: #999">MapReducer</a> <a href="/tags/Oracle/" style="font-size: 14px; color: #999">Oracle</a> <a href="/tags/Set/" style="font-size: 14px; color: #999">Set</a> <a href="/tags/Shuffle/" style="font-size: 14px; color: #999">Shuffle</a> <a href="/tags/String/" style="font-size: 16.5px; color: #888">String</a> <a href="/tags/YARN/" style="font-size: 14px; color: #999">YARN</a> <a href="/tags/ajax/" style="font-size: 14px; color: #999">ajax</a> <a href="/tags/cluster/" style="font-size: 14px; color: #999">cluster</a> <a href="/tags/cookie/" style="font-size: 14px; color: #999">cookie</a> <a href="/tags/exception/" style="font-size: 14px; color: #999">exception</a> <a href="/tags/google/" style="font-size: 14px; color: #999">google</a> <a href="/tags/gson/" style="font-size: 14px; color: #999">gson</a> <a href="/tags/hadoop/" style="font-size: 21.5px; color: #666">hadoop</a> <a href="/tags/hbase/" style="font-size: 14px; color: #999">hbase</a> <a href="/tags/hexo-主题-更换/" style="font-size: 14px; color: #999">hexo 主题 更换</a> <a href="/tags/hibernate-validation/" style="font-size: 14px; color: #999">hibernate-validation</a> <a href="/tags/ibator/" style="font-size: 14px; color: #999">ibator</a> <a href="/tags/java/" style="font-size: 24px; color: #555">java</a> <a href="/tags/javase/" style="font-size: 14px; color: #999">javase</a> <a href="/tags/java虚拟机/" style="font-size: 14px; color: #999">java虚拟机</a> <a href="/tags/jquery/" style="font-size: 14px; color: #999">jquery</a> <a href="/tags/json/" style="font-size: 14px; color: #999">json</a> <a href="/tags/jsp/" style="font-size: 14px; color: #999">jsp</a> <a href="/tags/jvm/" style="font-size: 16.5px; color: #888">jvm</a> <a href="/tags/linux/" style="font-size: 14px; color: #999">linux</a> <a href="/tags/mybatis/" style="font-size: 19px; color: #777">mybatis</a> <a href="/tags/mysql/" style="font-size: 19px; color: #777">mysql</a> <a href="/tags/mysql索引优化/" style="font-size: 14px; color: #999">mysql索引优化</a> <a href="/tags/oracle/" style="font-size: 16.5px; color: #888">oracle</a> <a href="/tags/session/" style="font-size: 14px; color: #999">session</a> <a href="/tags/spring/" style="font-size: 14px; color: #999">spring</a> <a href="/tags/springboot/" style="font-size: 14px; color: #999">springboot</a> <a href="/tags/springmvc/" style="font-size: 14px; color: #999">springmvc</a> <a href="/tags/sql/" style="font-size: 14px; color: #999">sql</a> <a href="/tags/sqoop/" style="font-size: 14px; color: #999">sqoop</a> <a href="/tags/tomcat/" style="font-size: 14px; color: #999">tomcat</a> <a href="/tags/validation/" style="font-size: 14px; color: #999">validation</a> <a href="/tags/vmware/" style="font-size: 14px; color: #999">vmware</a> <a href="/tags/windows/" style="font-size: 14px; color: #999">windows</a> <a href="/tags/zookeeper/" style="font-size: 16.5px; color: #888">zookeeper</a> <a href="/tags/临时表/" style="font-size: 14px; color: #999">临时表</a> <a href="/tags/事务/" style="font-size: 14px; color: #999">事务</a> <a href="/tags/事务隔离级别/" style="font-size: 14px; color: #999">事务隔离级别</a> <a href="/tags/升序，降序/" style="font-size: 14px; color: #999">升序，降序</a> <a href="/tags/多线程/" style="font-size: 14px; color: #999">多线程</a> <a href="/tags/异常/" style="font-size: 14px; color: #999">异常</a> <a href="/tags/数据库/" style="font-size: 16.5px; color: #888">数据库</a> <a href="/tags/日期转换/" style="font-size: 14px; color: #999">日期转换</a> <a href="/tags/线程池/" style="font-size: 14px; color: #999">线程池</a> <a href="/tags/集合/" style="font-size: 14px; color: #999">集合</a>
        </div>
    </section>


    
    
        
    <section class='m_widget toc-wrapper'>
        <header class="header pure">
            <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;目录</div>
            <div class='wrapper'><a class="s-toc rightBtn" title="固定到顶部" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
        </header>
        <div class='content pure'>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、-简介"><span class="toc-text">一、 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、-逻辑视图"><span class="toc-text">二、 逻辑视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Row-Key"><span class="toc-text">Row Key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#列族"><span class="toc-text">列族</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时间戳"><span class="toc-text">时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cell"><span class="toc-text">Cell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、-物理存储"><span class="toc-text">三、 物理存储</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、-系统架构"><span class="toc-text">四、 系统架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Client"><span class="toc-text">Client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zookeeper"><span class="toc-text">Zookeeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master"><span class="toc-text">Master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Region-Server"><span class="toc-text">Region Server</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、关键算法-流程"><span class="toc-text">五、关键算法 / 流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#region定位"><span class="toc-text">region定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读写过程"><span class="toc-text">读写过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#region分配"><span class="toc-text">region分配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#region-server上线"><span class="toc-text">region server上线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#region-server下线"><span class="toc-text">region server下线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#master上线"><span class="toc-text">master上线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#master下线"><span class="toc-text">master下线</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六、访问接口"><span class="toc-text">六、访问接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#七、结语："><span class="toc-text">七、结语：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考文档"><span class="toc-text">参考文档</span></a></li></ol>
        </div>
    </section>


    
    
    
        <section class='m_widget links'>
    <header class='header pure'>
        <div><i class="fas fa-handshake fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;友链</div>
        
            <a class="rightBtn" title="联系博主添加友链" target="_blank" rel="external nofollow noopener noreferrer" href="mailto:nytom@foxmail.com?subject=交换友链&body=你好，我想和你交换友链，我已经将【农永滔的博客】添加到我的博客的友链中。我的博客链接是："><i class="fas fa-plus fa-fw"></i></a>
        
    </header>
    <div class='content pure'>
        <ul class="entry" id="links">
            
                <li><a class="flat-box" title="https://tokerr.github.io" target="_blank" rel="external nofollow noopener noreferrer" href="https://tokerr.github.io">
                    <div class='name'>
                        
                            <img src="https://raw.githubusercontent.com/tokerr/markdownImage/master/images/favicon.png">
                        
                        &nbsp;&nbsp;农永滔的博客
                    </div>
                </a></li>
            
                <li><a class="flat-box" title="https://skydh.github.io" target="_blank" rel="external nofollow noopener noreferrer" href="https://skydh.github.io">
                    <div class='name'>
                        
                            <img src="http://t2.hddhhn.com/uploads/tu/201811/9999/84695947e4.jpg">
                        
                        &nbsp;&nbsp;董航的博客
                    </div>
                </a></li>
            
        </ul>
    </div>
</section>

    


        </aside>
        <script>setLoadingBarProgress(60);</script>
    </div>
    </div>
    <footer id="footer" class="clearfix">
    
        <div class="social-wrapper">
          
              
                  <a href="mailto:nytom@foxmail.com" class="social fas fa-envelope flat-box" target="_blank" rel="external"></a>
              
          
              
                  <a href="https://github.com/tokerr" class="social fab fa-github flat-box" target="_blank" rel="external"></a>
              
          
              
                  <a href="https://y.qq.com/n/yqq/playlist/2801715580.html" class="social fas fa-music flat-box" target="_blank" rel="external"></a>
              
          
        </div>
    
    <br>
    <div>欢迎访问我的博客，一个对世界充满好奇的程序猿。</div>
    <!--
    <div>博客内容遵循 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="licenses">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></div>
    <div>本站使用 <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a> 作为主题，
		总访问量为 <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
    </div>
    -->
    <!--评论系统-->
        <!-- Gitalk 评论 start  -->
        <!-- Link Gitalk 的支持文件  -->
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
        <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
        <div id="gitalk-container"></div>
        <script type="text/javascript">
        !function(n){"use strict";function t(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]}function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function d(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function h(n){return a(i(d(n),8*n.length))}function l(n,t){var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),e+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return e}function v(n){return unescape(encodeURIComponent(n))}function m(n){return h(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define(function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);
            var gitalk = new Gitalk({
        		clientID: 'a7488698e2bf8aa0b134',
        		clientSecret: '6edd169757d428197eb48c088bb8a12e8c09ebd6',
        		repo: 'tokerr.github.io',
        		owner: 'tokerr',
        		admin: ['tokerr'],
        		id: md5(window.location.pathname),
        		distractionFreeMode: true
            });
            gitalk.render('gitalk-container');
        </script>
        <!-- Gitalk end -->
        <br>
        <div>本站使用 <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a> 作为主题
        <!--
        ，总访问量为 <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
        -->
        </div>
</footer>
<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->


    <script>setLoadingBarProgress(80);</script>
    <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<!-- 访问统计 -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/jquery.fitvids.js"></script>

    <script>
        var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
        var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
        var ALGOLIA_API_KEY = "";
        var ALGOLIA_APP_ID = "";
        var ALGOLIA_INDEX_NAME = "";
        var AZURE_SERVICE_NAME = "";
        var AZURE_INDEX_NAME = "";
        var AZURE_QUERY_KEY = "";
        var BAIDU_API_ID = "";
        var SEARCH_SERVICE = "hexo" || "hexo";
        var ROOT = "/"||"/";
        if(!ROOT.endsWith('/'))ROOT += '/';
    </script>

<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


    
    
    





    <script>setLoadingBarProgress(100);</script>
</body>
